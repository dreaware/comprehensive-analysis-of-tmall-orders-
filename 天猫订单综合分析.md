# 天猫订单综合分析

## 一、 数据介绍  
数据来源：https://www.kesci.com/mw/project/5eb60fd0366f4d002d7792d5/dataset  
本数据集共收集了发生在2020年2月1日至2020年2月29日一个月内的28010条数据，均来自天猫真实订单。  
字段说明：  
1. 订单编号：订单编号  
2. 总金额：订单总金额  
3. 买家实际支付金额：总金额 - 退款金额（在已付款的情况下）。金额为0（在未付款的情况下）  
4. 收货地址：各个省份  
5. 订单创建时间：下单时间  
6. 订单付款时间：付款时间  
7. 退款金额：付款后申请退款的金额。如无付过款，退款金额为0  

## 二、 分析目的  
1. 计算订单每个环节的转化转化率，得到漏斗图  
2. 绘制订单成交的时间（按天）趋势(按实际成交）  
3. 将订单数在地图上的分布

## 三、 数据预处理


```python
import numpy as np
from matplotlib import pyplot as plt
import pandas as pd
import os
import warnings
warnings.filterwarnings('ignore')

import matplotlib
matplotlib.use('qt4agg')
#指定默认字体
matplotlib.rcParams['font.sans-serif'] = ['SimHei']
matplotlib.rcParams['font.family']='sans-serif'
#解决负号'-'显示为方块的问题
matplotlib.rcParams['axes.unicode_minus'] = False

df = pd.read_csv('./data/tmall_order_report.csv',engine = 'python',encoding = 'utf')
```


```python
df.head()
```




<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>订单编号</th>
      <th>总金额</th>
      <th>买家实际支付金额</th>
      <th>收货地址</th>
      <th>订单创建时间</th>
      <th>订单付款时间</th>
      <th>退款金额</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>1</td>
      <td>178.8</td>
      <td>0.0</td>
      <td>上海</td>
      <td>2020-02-21 00:00:00</td>
      <td>NaN</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>1</th>
      <td>2</td>
      <td>21.0</td>
      <td>21.0</td>
      <td>内蒙古自治区</td>
      <td>2020-02-20 23:59:54</td>
      <td>2020-02-21 00:00:02</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>2</th>
      <td>3</td>
      <td>37.0</td>
      <td>0.0</td>
      <td>安徽省</td>
      <td>2020-02-20 23:59:35</td>
      <td>NaN</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>3</th>
      <td>4</td>
      <td>157.0</td>
      <td>157.0</td>
      <td>湖南省</td>
      <td>2020-02-20 23:58:34</td>
      <td>2020-02-20 23:58:44</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>4</th>
      <td>5</td>
      <td>64.8</td>
      <td>0.0</td>
      <td>江苏省</td>
      <td>2020-02-20 23:57:04</td>
      <td>2020-02-20 23:57:11</td>
      <td>64.8</td>
    </tr>
  </tbody>
</table>
</div>




```python
df.tail()
```




<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>订单编号</th>
      <th>总金额</th>
      <th>买家实际支付金额</th>
      <th>收货地址</th>
      <th>订单创建时间</th>
      <th>订单付款时间</th>
      <th>退款金额</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>28005</th>
      <td>28006</td>
      <td>37.0</td>
      <td>37.0</td>
      <td>四川省</td>
      <td>2020-02-27 00:01:00</td>
      <td>2020-02-27 00:01:10</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>28006</th>
      <td>28007</td>
      <td>69.0</td>
      <td>0.0</td>
      <td>上海</td>
      <td>2020-02-27 00:00:18</td>
      <td>NaN</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>28007</th>
      <td>28008</td>
      <td>69.0</td>
      <td>0.0</td>
      <td>上海</td>
      <td>2020-02-27 00:00:17</td>
      <td>NaN</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>28008</th>
      <td>28009</td>
      <td>37.0</td>
      <td>37.0</td>
      <td>辽宁省</td>
      <td>2020-02-27 00:00:09</td>
      <td>2020-02-27 00:00:17</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>28009</th>
      <td>28010</td>
      <td>37.0</td>
      <td>37.0</td>
      <td>广东省</td>
      <td>2020-02-27 00:00:06</td>
      <td>2020-02-27 00:00:11</td>
      <td>0.0</td>
    </tr>
  </tbody>
</table>
</div>



### 1. 规范字段名称  
查看数据集字段名称发现，部分字段名称后有空格，为了方便后面的数据分析，因此需将空格删去。


```python
df.columns
```




    Index(['订单编号', '总金额', '买家实际支付金额', '收货地址 ', '订单创建时间', '订单付款时间 ', '退款金额'], dtype='object')




```python
# 将字段名称中空格去掉，规范字段名称
df = df.rename( columns = {'收货地址 ':'收货地址','订单付款时间 ':'订单付款时间'} )
df.columns
```




    Index(['订单编号', '总金额', '买家实际支付金额', '收货地址', '订单创建时间', '订单付款时间', '退款金额'], dtype='object')



### 2. 重复值处理


```python
df.duplicated().sum()
```




    0



由以上运行结果可知，本数据集并无重复值。

### 3. 缺失值处理


```python
df.isnull().sum()
# 订单付款时间 有2923个缺失值，属于正常现象，说明这些单位付过款，无需处理
```




    订单编号           0
    总金额            0
    买家实际支付金额       0
    收货地址           0
    订单创建时间         0
    订单付款时间      3923
    退款金额           0
    dtype: int64



由以上运行结果可知，本数据集并无缺失值。

## 四、数据分析

### （一） 订单转化率  
### 1. 计算每个环节的数据  
整个订单的环节包括：用户下单->用户付款->卖家收款->卖家全额收款。


```python
dict_convs = dict()
```

**（1） 订单总数**  
订单总数可用于表示用户下单这一环节。


```python
key = '总订单数'

dict_convs[key] = len(df)
len(df)
```




    28010



**（2） 付过款的订单数**  
只要付款时间不为零，则可表示该用户已付过款。因此付过款的订单数可用来表示用户付款这一环节。


```python
key = '付款订单数'

# 付款时间不为空的，表示付过款
df_payed = df[df['订单付款时间'].notnull()]
dict_convs[key] = len(df_payed)

len(df_payed)
```




    24087



**（3） 到款订单数**  
用户付款后也可能存在退款的情况，但是要买家实际付款不为零，则可表示卖家收到过款。因此到款订单数可用来表示卖家收款这一环节。


```python
key = '到款订单数'

# 买家实际支付金额：总金额 - 退款金额（在已付款的情况下）
# 买家实际支付金额不为0的，说明订单商家收到过款
df_trans = df_payed[df_payed['买家实际支付金额'] != 0]
dict_convs[key] = len(df_trans)

len(df_trans)
```




    18955



**（4） 全额到款订单数**  
用户付款后，只要退款金额为零，则表示用户全额付款，卖家已全额收款。因此全额到款订单数可用来表示卖家全额收款，此时整个订单的购买流程已完成。


```python
key = '全额到款订单数'

# 在付款的订单中，退款金额为0的，说明没有退款，表示全额收款
df_trans_full = df_payed[df_payed['退款金额'] == 0]
dict_convs[key] = len(df_trans_full)

len(df_trans_full)
```




    18441



整个订单各个环节的数据如下：


```python
df_convs = pd.Series(dict_convs,name='订单数').to_frame()
df_convs
```




<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>订单数</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>总订单数</th>
      <td>28010</td>
    </tr>
    <tr>
      <th>付款订单数</th>
      <td>24087</td>
    </tr>
    <tr>
      <th>到款订单数</th>
      <td>18955</td>
    </tr>
    <tr>
      <th>全额到款订单数</th>
      <td>18441</td>
    </tr>
  </tbody>
</table>
</div>



### 2. 计算转化率，绘制漏斗图  
**（1） 总体转化率**


```python
# 添加总体转化率,每个环节除以总订单数
name = '总体转化率'
total_convs = df_convs['订单数']/df_convs.loc['总订单数','订单数']*100
df_convs[name] = total_convs.apply(lambda x : round(x,0))
df_convs
```




<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>订单数</th>
      <th>总体转化率</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>总订单数</th>
      <td>28010</td>
      <td>100.0</td>
    </tr>
    <tr>
      <th>付款订单数</th>
      <td>24087</td>
      <td>86.0</td>
    </tr>
    <tr>
      <th>到款订单数</th>
      <td>18955</td>
      <td>68.0</td>
    </tr>
    <tr>
      <th>全额到款订单数</th>
      <td>18441</td>
      <td>66.0</td>
    </tr>
  </tbody>
</table>
</div>




```python
from pyecharts.charts import Funnel
from pyecharts import options as opts
```


```python
name = '总体转化率'
funnel = Funnel().add(
                    series_name = name,
                    data_pair = [ list(z) for z in zip(df_convs.index,df_convs[name]) ],
                    is_selected = True,
                    label_opts = opts.LabelOpts(position = 'inside')
                    )
funnel.set_series_opts(tooltip_opts = opts.TooltipOpts(formatter = '{a}<br/>{b}:{c}%'))

funnel.set_global_opts( title_opts = opts.TitleOpts(title = name),
#                         tooltip_opts = opts.TooltipOpts(formatter = '{a}<br\>{b}:{c}%'),
                      )
                        
funnel.render_notebook()
```





<script>
    require.config({
        paths: {
            'echarts':'https://assets.pyecharts.org/assets/echarts.min'
        }
    });
</script>

        <div id="d3368e6650fd4c80bd55e4c6269381a9" style="width:900px; height:500px;"></div>

<script>
        require(['echarts'], function(echarts) {
                var chart_d3368e6650fd4c80bd55e4c6269381a9 = echarts.init(
                    document.getElementById('d3368e6650fd4c80bd55e4c6269381a9'), 'white', {renderer: 'canvas'});
                var option_d3368e6650fd4c80bd55e4c6269381a9 = {
    "animation": true,
    "animationThreshold": 2000,
    "animationDuration": 1000,
    "animationEasing": "cubicOut",
    "animationDelay": 0,
    "animationDurationUpdate": 300,
    "animationEasingUpdate": "cubicOut",
    "animationDelayUpdate": 0,
    "color": [
        "#c23531",
        "#2f4554",
        "#61a0a8",
        "#d48265",
        "#749f83",
        "#ca8622",
        "#bda29a",
        "#6e7074",
        "#546570",
        "#c4ccd3",
        "#f05b72",
        "#ef5b9c",
        "#f47920",
        "#905a3d",
        "#fab27b",
        "#2a5caa",
        "#444693",
        "#726930",
        "#b2d235",
        "#6d8346",
        "#ac6767",
        "#1d953f",
        "#6950a1",
        "#918597"
    ],
    "series": [
        {
            "type": "funnel",
            "name": "\u603b\u4f53\u8f6c\u5316\u7387",
            "data": [
                {
                    "name": "\u603b\u8ba2\u5355\u6570",
                    "value": 100.0
                },
                {
                    "name": "\u4ed8\u6b3e\u8ba2\u5355\u6570",
                    "value": 86.0
                },
                {
                    "name": "\u5230\u6b3e\u8ba2\u5355\u6570",
                    "value": 68.0
                },
                {
                    "name": "\u5168\u989d\u5230\u6b3e\u8ba2\u5355\u6570",
                    "value": 66.0
                }
            ],
            "sort": "descending",
            "gap": 0,
            "label": {
                "show": true,
                "position": "inside",
                "margin": 8
            },
            "tooltip": {
                "show": true,
                "trigger": "item",
                "triggerOn": "mousemove|click",
                "axisPointer": {
                    "type": "line"
                },
                "showContent": true,
                "alwaysShowContent": false,
                "showDelay": 0,
                "hideDelay": 100,
                "formatter": "{a}<br/>{b}:{c}%",
                "textStyle": {
                    "fontSize": 14
                },
                "borderWidth": 0,
                "padding": 5
            },
            "rippleEffect": {
                "show": true,
                "brushType": "stroke",
                "scale": 2.5,
                "period": 4
            }
        }
    ],
    "legend": [
        {
            "data": [
                "\u4ed8\u6b3e\u8ba2\u5355\u6570",
                "\u5168\u989d\u5230\u6b3e\u8ba2\u5355\u6570",
                "\u603b\u8ba2\u5355\u6570",
                "\u5230\u6b3e\u8ba2\u5355\u6570"
            ],
            "selected": {
                "\u603b\u8ba2\u5355\u6570": true,
                "\u4ed8\u6b3e\u8ba2\u5355\u6570": true,
                "\u5230\u6b3e\u8ba2\u5355\u6570": true,
                "\u5168\u989d\u5230\u6b3e\u8ba2\u5355\u6570": true
            },
            "show": true,
            "padding": 5,
            "itemGap": 10,
            "itemWidth": 25,
            "itemHeight": 14
        }
    ],
    "tooltip": {
        "show": true,
        "trigger": "item",
        "triggerOn": "mousemove|click",
        "axisPointer": {
            "type": "line"
        },
        "showContent": true,
        "alwaysShowContent": false,
        "showDelay": 0,
        "hideDelay": 100,
        "textStyle": {
            "fontSize": 14
        },
        "borderWidth": 0,
        "padding": 5
    },
    "title": [
        {
            "text": "\u603b\u4f53\u8f6c\u5316\u7387",
            "padding": 5,
            "itemGap": 10
        }
    ]
};
                chart_d3368e6650fd4c80bd55e4c6269381a9.setOption(option_d3368e6650fd4c80bd55e4c6269381a9);
        });
    </script>




**（2） 环节转化率**


```python
# 添加环节转化率,每个环节除以上一个环节
# 添加单一环节转化率,每个环节除以上一环节

name = '单一环节转化率'
single_convs = df_convs['订单数'].shift()

df_convs[name] = single_convs.fillna(df_convs.loc['总订单数','订单数'])

# df_convs[name] = (df_convs['订单数']/df_convs[name]*100).apply(lambda x : round(x,0))

df_convs[name] = round((df_convs['订单数']/df_convs[name]*100),0)
df_convs
```




<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>订单数</th>
      <th>总体转化率</th>
      <th>单一环节转化率</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>总订单数</th>
      <td>28010</td>
      <td>100.0</td>
      <td>100.0</td>
    </tr>
    <tr>
      <th>付款订单数</th>
      <td>24087</td>
      <td>86.0</td>
      <td>86.0</td>
    </tr>
    <tr>
      <th>到款订单数</th>
      <td>18955</td>
      <td>68.0</td>
      <td>79.0</td>
    </tr>
    <tr>
      <th>全额到款订单数</th>
      <td>18441</td>
      <td>66.0</td>
      <td>97.0</td>
    </tr>
  </tbody>
</table>
</div>




```python
name = '单一环节转化率'

funnel = Funnel().add(
                    series_name = name,
                    data_pair = [ list(z) for z in zip(df_convs.index,df_convs[name]) ],
                    is_selected = True,
                    label_opts = opts.LabelOpts(position = 'inside')
                    )
funnel.set_series_opts(tooltip_opts = opts.TooltipOpts(formatter = '{a}<br/>{b}:{c}%'))

funnel.set_global_opts( title_opts = opts.TitleOpts(title = name),
#                         tooltip_opts = opts.TooltipOpts(formatter = '{a}<br\>{b}:{c}%'),
                      )
                        
funnel.render_notebook()
```





<script>
    require.config({
        paths: {
            'echarts':'https://assets.pyecharts.org/assets/echarts.min'
        }
    });
</script>

        <div id="037252f97c3340a68e6f4444e40d9a44" style="width:900px; height:500px;"></div>

<script>
        require(['echarts'], function(echarts) {
                var chart_037252f97c3340a68e6f4444e40d9a44 = echarts.init(
                    document.getElementById('037252f97c3340a68e6f4444e40d9a44'), 'white', {renderer: 'canvas'});
                var option_037252f97c3340a68e6f4444e40d9a44 = {
    "animation": true,
    "animationThreshold": 2000,
    "animationDuration": 1000,
    "animationEasing": "cubicOut",
    "animationDelay": 0,
    "animationDurationUpdate": 300,
    "animationEasingUpdate": "cubicOut",
    "animationDelayUpdate": 0,
    "color": [
        "#c23531",
        "#2f4554",
        "#61a0a8",
        "#d48265",
        "#749f83",
        "#ca8622",
        "#bda29a",
        "#6e7074",
        "#546570",
        "#c4ccd3",
        "#f05b72",
        "#ef5b9c",
        "#f47920",
        "#905a3d",
        "#fab27b",
        "#2a5caa",
        "#444693",
        "#726930",
        "#b2d235",
        "#6d8346",
        "#ac6767",
        "#1d953f",
        "#6950a1",
        "#918597"
    ],
    "series": [
        {
            "type": "funnel",
            "name": "\u5355\u4e00\u73af\u8282\u8f6c\u5316\u7387",
            "data": [
                {
                    "name": "\u603b\u8ba2\u5355\u6570",
                    "value": 100.0
                },
                {
                    "name": "\u4ed8\u6b3e\u8ba2\u5355\u6570",
                    "value": 86.0
                },
                {
                    "name": "\u5230\u6b3e\u8ba2\u5355\u6570",
                    "value": 79.0
                },
                {
                    "name": "\u5168\u989d\u5230\u6b3e\u8ba2\u5355\u6570",
                    "value": 97.0
                }
            ],
            "sort": "descending",
            "gap": 0,
            "label": {
                "show": true,
                "position": "inside",
                "margin": 8
            },
            "tooltip": {
                "show": true,
                "trigger": "item",
                "triggerOn": "mousemove|click",
                "axisPointer": {
                    "type": "line"
                },
                "showContent": true,
                "alwaysShowContent": false,
                "showDelay": 0,
                "hideDelay": 100,
                "formatter": "{a}<br/>{b}:{c}%",
                "textStyle": {
                    "fontSize": 14
                },
                "borderWidth": 0,
                "padding": 5
            },
            "rippleEffect": {
                "show": true,
                "brushType": "stroke",
                "scale": 2.5,
                "period": 4
            }
        }
    ],
    "legend": [
        {
            "data": [
                "\u4ed8\u6b3e\u8ba2\u5355\u6570",
                "\u5168\u989d\u5230\u6b3e\u8ba2\u5355\u6570",
                "\u603b\u8ba2\u5355\u6570",
                "\u5230\u6b3e\u8ba2\u5355\u6570"
            ],
            "selected": {
                "\u603b\u8ba2\u5355\u6570": true,
                "\u4ed8\u6b3e\u8ba2\u5355\u6570": true,
                "\u5230\u6b3e\u8ba2\u5355\u6570": true,
                "\u5168\u989d\u5230\u6b3e\u8ba2\u5355\u6570": true
            },
            "show": true,
            "padding": 5,
            "itemGap": 10,
            "itemWidth": 25,
            "itemHeight": 14
        }
    ],
    "tooltip": {
        "show": true,
        "trigger": "item",
        "triggerOn": "mousemove|click",
        "axisPointer": {
            "type": "line"
        },
        "showContent": true,
        "alwaysShowContent": false,
        "showDelay": 0,
        "hideDelay": 100,
        "textStyle": {
            "fontSize": 14
        },
        "borderWidth": 0,
        "padding": 5
    },
    "title": [
        {
            "text": "\u5355\u4e00\u73af\u8282\u8f6c\u5316\u7387",
            "padding": 5,
            "itemGap": 10
        }
    ]
};
                chart_037252f97c3340a68e6f4444e40d9a44.setOption(option_037252f97c3340a68e6f4444e40d9a44);
        });
    </script>




### （二） 整体订单趋势

### 1. 整体订单数趋势


```python
from pyecharts.charts import Line
```


```python
# 按到款订单统计
df_trans['订单创建时间'] = df_trans['订单创建时间'].astype('datetime64')
df_trans=df_trans.set_index('订单创建时间')
df_trans.head()
```




<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>订单编号</th>
      <th>总金额</th>
      <th>买家实际支付金额</th>
      <th>收货地址</th>
      <th>订单付款时间</th>
      <th>退款金额</th>
    </tr>
    <tr>
      <th>订单创建时间</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>2020-02-20 23:59:54</th>
      <td>2</td>
      <td>21.0</td>
      <td>21.0</td>
      <td>内蒙古自治区</td>
      <td>2020-02-21 00:00:02</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>2020-02-20 23:58:34</th>
      <td>4</td>
      <td>157.0</td>
      <td>157.0</td>
      <td>湖南省</td>
      <td>2020-02-20 23:58:44</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>2020-02-20 23:56:39</th>
      <td>6</td>
      <td>327.7</td>
      <td>148.9</td>
      <td>浙江省</td>
      <td>2020-02-20 23:56:53</td>
      <td>178.8</td>
    </tr>
    <tr>
      <th>2020-02-20 23:56:36</th>
      <td>7</td>
      <td>357.0</td>
      <td>357.0</td>
      <td>天津</td>
      <td>2020-02-20 23:56:40</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>2020-02-20 23:56:12</th>
      <td>8</td>
      <td>53.0</td>
      <td>53.0</td>
      <td>浙江省</td>
      <td>2020-02-20 23:56:16</td>
      <td>0.0</td>
    </tr>
  </tbody>
</table>
</div>




```python
se_trans_month = df_trans.resample('D')['订单编号'].count()

name = '订单数'

(
    Line()
    .add_xaxis(xaxis_data = list(se_trans_month.index.day.map(str)))
    .add_yaxis(
        series_name= name,
        y_axis= se_trans_month,

    )
    .set_global_opts(
        yaxis_opts = opts.AxisOpts(
            splitline_opts = opts.SplitLineOpts(is_show = True)
        )
    )
    .render_notebook()
)
```





<script>
    require.config({
        paths: {
            'echarts':'https://assets.pyecharts.org/assets/echarts.min'
        }
    });
</script>

        <div id="e5fc98599cb44f2f9bb3c2a4290ca707" style="width:900px; height:500px;"></div>

<script>
        require(['echarts'], function(echarts) {
                var chart_e5fc98599cb44f2f9bb3c2a4290ca707 = echarts.init(
                    document.getElementById('e5fc98599cb44f2f9bb3c2a4290ca707'), 'white', {renderer: 'canvas'});
                var option_e5fc98599cb44f2f9bb3c2a4290ca707 = {
    "animation": true,
    "animationThreshold": 2000,
    "animationDuration": 1000,
    "animationEasing": "cubicOut",
    "animationDelay": 0,
    "animationDurationUpdate": 300,
    "animationEasingUpdate": "cubicOut",
    "animationDelayUpdate": 0,
    "color": [
        "#c23531",
        "#2f4554",
        "#61a0a8",
        "#d48265",
        "#749f83",
        "#ca8622",
        "#bda29a",
        "#6e7074",
        "#546570",
        "#c4ccd3",
        "#f05b72",
        "#ef5b9c",
        "#f47920",
        "#905a3d",
        "#fab27b",
        "#2a5caa",
        "#444693",
        "#726930",
        "#b2d235",
        "#6d8346",
        "#ac6767",
        "#1d953f",
        "#6950a1",
        "#918597"
    ],
    "series": [
        {
            "type": "line",
            "name": "\u8ba2\u5355\u6570",
            "connectNulls": false,
            "symbolSize": 4,
            "showSymbol": true,
            "smooth": false,
            "clip": true,
            "step": false,
            "data": [
                [
                    "1",
                    87
                ],
                [
                    "2",
                    107
                ],
                [
                    "3",
                    136
                ],
                [
                    "4",
                    254
                ],
                [
                    "5",
                    194
                ],
                [
                    "6",
                    71
                ],
                [
                    "7",
                    95
                ],
                [
                    "8",
                    0
                ],
                [
                    "9",
                    266
                ],
                [
                    "10",
                    16
                ],
                [
                    "11",
                    14
                ],
                [
                    "12",
                    1
                ],
                [
                    "13",
                    5
                ],
                [
                    "14",
                    7
                ],
                [
                    "15",
                    4
                ],
                [
                    "16",
                    0
                ],
                [
                    "17",
                    267
                ],
                [
                    "18",
                    658
                ],
                [
                    "19",
                    700
                ],
                [
                    "20",
                    935
                ],
                [
                    "21",
                    1446
                ],
                [
                    "22",
                    1428
                ],
                [
                    "23",
                    1577
                ],
                [
                    "24",
                    1349
                ],
                [
                    "25",
                    2283
                ],
                [
                    "26",
                    1919
                ],
                [
                    "27",
                    1799
                ],
                [
                    "28",
                    1873
                ],
                [
                    "29",
                    1464
                ]
            ],
            "hoverAnimation": true,
            "label": {
                "show": true,
                "position": "top",
                "margin": 8
            },
            "lineStyle": {
                "show": true,
                "width": 1,
                "opacity": 1,
                "curveness": 0,
                "type": "solid"
            },
            "areaStyle": {
                "opacity": 0
            },
            "zlevel": 0,
            "z": 0
        }
    ],
    "legend": [
        {
            "data": [
                "\u8ba2\u5355\u6570"
            ],
            "selected": {
                "\u8ba2\u5355\u6570": true
            },
            "show": true,
            "padding": 5,
            "itemGap": 10,
            "itemWidth": 25,
            "itemHeight": 14
        }
    ],
    "tooltip": {
        "show": true,
        "trigger": "item",
        "triggerOn": "mousemove|click",
        "axisPointer": {
            "type": "line"
        },
        "showContent": true,
        "alwaysShowContent": false,
        "showDelay": 0,
        "hideDelay": 100,
        "textStyle": {
            "fontSize": 14
        },
        "borderWidth": 0,
        "padding": 5
    },
    "xAxis": [
        {
            "show": true,
            "scale": false,
            "nameLocation": "end",
            "nameGap": 15,
            "gridIndex": 0,
            "inverse": false,
            "offset": 0,
            "splitNumber": 5,
            "minInterval": 0,
            "splitLine": {
                "show": false,
                "lineStyle": {
                    "show": true,
                    "width": 1,
                    "opacity": 1,
                    "curveness": 0,
                    "type": "solid"
                }
            },
            "data": [
                "1",
                "2",
                "3",
                "4",
                "5",
                "6",
                "7",
                "8",
                "9",
                "10",
                "11",
                "12",
                "13",
                "14",
                "15",
                "16",
                "17",
                "18",
                "19",
                "20",
                "21",
                "22",
                "23",
                "24",
                "25",
                "26",
                "27",
                "28",
                "29"
            ]
        }
    ],
    "yAxis": [
        {
            "show": true,
            "scale": false,
            "nameLocation": "end",
            "nameGap": 15,
            "gridIndex": 0,
            "inverse": false,
            "offset": 0,
            "splitNumber": 5,
            "minInterval": 0,
            "splitLine": {
                "show": true,
                "lineStyle": {
                    "show": true,
                    "width": 1,
                    "opacity": 1,
                    "curveness": 0,
                    "type": "solid"
                }
            }
        }
    ],
    "title": [
        {
            "padding": 5,
            "itemGap": 10
        }
    ]
};
                chart_e5fc98599cb44f2f9bb3c2a4290ca707.setOption(option_e5fc98599cb44f2f9bb3c2a4290ca707);
        });
    </script>




### （三） 销量区域分布


```python
se_trans_map = df_trans.groupby('收货地址')['收货地址'].count().sort_values(ascending = False)
plt.figure(dpi = 100)
se_trans_map.plot(kind = 'bar')
# len(se_trans_map)
```




    <AxesSubplot:xlabel='收货地址'>




    
![png](output_42_1.png)
    



```python
# 为了保持由于下面的地理分布图使用的省份名称一致，定义一个处理自治区的函数
def strip_region(iterable):
    result = []
    for i in iterable:
        if i.endswith('自治区'):
            if i == '内蒙古自治区':
                i = i[:3]
                result.append(i)
            else:
                result.append(i[:2])
        else:
            result.append(i)
    return result
```


```python
# 处理自治区,
se_trans_map.index = strip_region(se_trans_map.index)

# 去掉末位‘省’字
se_trans_map.index = se_trans_map.index.str.strip('省')
```


```python
import pyecharts.options as opts
from pyecharts.charts import Map
```


```python
# 展示地理分布图
name = '订单数'

(
    Map()
    .add(
        series_name = name,
        data_pair= [list(i) for i in se_trans_map.items()])
    .set_global_opts(visualmap_opts=opts.VisualMapOpts(
        max_=max(se_trans_map)*0.6
    )
                    )
    .render_notebook()
)
```





<script>
    require.config({
        paths: {
            'echarts':'https://assets.pyecharts.org/assets/echarts.min', 'china':'https://assets.pyecharts.org/assets/maps/china'
        }
    });
</script>

        <div id="5949bb47c1c942adbd43ee8123d50a58" style="width:900px; height:500px;"></div>

<script>
        require(['echarts', 'china'], function(echarts) {
                var chart_5949bb47c1c942adbd43ee8123d50a58 = echarts.init(
                    document.getElementById('5949bb47c1c942adbd43ee8123d50a58'), 'white', {renderer: 'canvas'});
                var option_5949bb47c1c942adbd43ee8123d50a58 = {
    "animation": true,
    "animationThreshold": 2000,
    "animationDuration": 1000,
    "animationEasing": "cubicOut",
    "animationDelay": 0,
    "animationDurationUpdate": 300,
    "animationEasingUpdate": "cubicOut",
    "animationDelayUpdate": 0,
    "color": [
        "#c23531",
        "#2f4554",
        "#61a0a8",
        "#d48265",
        "#749f83",
        "#ca8622",
        "#bda29a",
        "#6e7074",
        "#546570",
        "#c4ccd3",
        "#f05b72",
        "#ef5b9c",
        "#f47920",
        "#905a3d",
        "#fab27b",
        "#2a5caa",
        "#444693",
        "#726930",
        "#b2d235",
        "#6d8346",
        "#ac6767",
        "#1d953f",
        "#6950a1",
        "#918597"
    ],
    "series": [
        {
            "type": "map",
            "name": "\u8ba2\u5355\u6570",
            "label": {
                "show": true,
                "position": "top",
                "margin": 8
            },
            "mapType": "china",
            "data": [
                {
                    "name": "\u4e0a\u6d77",
                    "value": 2470
                },
                {
                    "name": "\u5e7f\u4e1c",
                    "value": 1585
                },
                {
                    "name": "\u5317\u4eac",
                    "value": 1489
                },
                {
                    "name": "\u6c5f\u82cf",
                    "value": 1459
                },
                {
                    "name": "\u6d59\u6c5f",
                    "value": 1438
                },
                {
                    "name": "\u56db\u5ddd",
                    "value": 1380
                },
                {
                    "name": "\u5c71\u4e1c",
                    "value": 1145
                },
                {
                    "name": "\u5929\u6d25",
                    "value": 838
                },
                {
                    "name": "\u8fbd\u5b81",
                    "value": 812
                },
                {
                    "name": "\u6e56\u5357",
                    "value": 747
                },
                {
                    "name": "\u91cd\u5e86",
                    "value": 691
                },
                {
                    "name": "\u6cb3\u5317",
                    "value": 686
                },
                {
                    "name": "\u6cb3\u5357",
                    "value": 607
                },
                {
                    "name": "\u4e91\u5357",
                    "value": 528
                },
                {
                    "name": "\u5b89\u5fbd",
                    "value": 392
                },
                {
                    "name": "\u9655\u897f",
                    "value": 359
                },
                {
                    "name": "\u5c71\u897f",
                    "value": 317
                },
                {
                    "name": "\u798f\u5efa",
                    "value": 315
                },
                {
                    "name": "\u5e7f\u897f",
                    "value": 278
                },
                {
                    "name": "\u5409\u6797",
                    "value": 260
                },
                {
                    "name": "\u6c5f\u897f",
                    "value": 256
                },
                {
                    "name": "\u9ed1\u9f99\u6c5f",
                    "value": 231
                },
                {
                    "name": "\u8d35\u5dde",
                    "value": 228
                },
                {
                    "name": "\u5185\u8499\u53e4",
                    "value": 136
                },
                {
                    "name": "\u6d77\u5357",
                    "value": 119
                },
                {
                    "name": "\u7518\u8083",
                    "value": 108
                },
                {
                    "name": "\u5b81\u590f",
                    "value": 32
                },
                {
                    "name": "\u6e56\u5317",
                    "value": 18
                },
                {
                    "name": "\u65b0\u7586",
                    "value": 16
                },
                {
                    "name": "\u9752\u6d77",
                    "value": 15
                }
            ],
            "roam": true,
            "aspectScale": 0.75,
            "nameProperty": "name",
            "selectedMode": false,
            "zoom": 1,
            "mapValueCalculation": "sum",
            "showLegendSymbol": true,
            "emphasis": {}
        }
    ],
    "legend": [
        {
            "data": [
                "\u8ba2\u5355\u6570"
            ],
            "selected": {
                "\u8ba2\u5355\u6570": true
            },
            "show": true,
            "padding": 5,
            "itemGap": 10,
            "itemWidth": 25,
            "itemHeight": 14
        }
    ],
    "tooltip": {
        "show": true,
        "trigger": "item",
        "triggerOn": "mousemove|click",
        "axisPointer": {
            "type": "line"
        },
        "showContent": true,
        "alwaysShowContent": false,
        "showDelay": 0,
        "hideDelay": 100,
        "textStyle": {
            "fontSize": 14
        },
        "borderWidth": 0,
        "padding": 5
    },
    "title": [
        {
            "padding": 5,
            "itemGap": 10
        }
    ],
    "visualMap": {
        "show": true,
        "type": "continuous",
        "min": 0,
        "max": 1482.0,
        "inRange": {
            "color": [
                "#50a3ba",
                "#eac763",
                "#d94e5d"
            ]
        },
        "calculable": true,
        "inverse": false,
        "splitNumber": 5,
        "orient": "vertical",
        "showLabel": true,
        "itemWidth": 20,
        "itemHeight": 140,
        "borderWidth": 0
    }
};
                chart_5949bb47c1c942adbd43ee8123d50a58.setOption(option_5949bb47c1c942adbd43ee8123d50a58);
        });
    </script>




## 五、结论  
1. 需要提高非活动期间用户的下单量，建议深入分析用户是否到达流失期，分析用户在平台中的生命周期时间，结合实际情况探索新类型的用户。  
2. 对付款时间超过10分钟以上的用户进行行为分析与用户调研，探索过长时间付款的原因，是否是由平台bug等问题产生的，可以添加自动订单付款push的功能。  
3. 通过按成交天数分析，在2月上半月，由于疫情等停工停产，物流快递停运等原因，订单量普遍较少，甚至少有10单。在下半月，随着复工复产，订单量开始上升，逐渐恢复。
2. 订单量主要分布在东部沿海较发达地区，而内陆偏远地区，即俗称的不包邮区以及疫情较重的湖北省的订单量相对较少。这与我国经济发展分布是有较大关系。

